---
title: "Rancherの使い方"
weight : 1
---

### Rancherの用途

Rancherは主に以下の用途で利用します。

- カタログを使った開発環境の立ち上げ/立ち下げ
- 立ち上げた環境へのアクセス

リンク

- Rancher: `http://10.xxx.xxx.xxx:9080`

---

#### ログイン画面

![login](/images/rancher_login.png)

---

#### ログイン方法

ログイン画面からユーザー名・パスワードを入力します。

{{% notice note %}}
ユーザー名・パスワードはシステム管理者から提供されますので、不明な場合はシステム管理者に確認してください。
{{% /notice %}}

---

#### ログイン直後のトップ画面

![top](/images/rancher_top.png)

| 番号 | 説明 |
| ------------- | ------------- |
| ① | 管理しているクラスターの一覧です。複数のクラスターがあれば複数表示されます。 |

{{% notice info %}}
クラスターとは  
複数台のPCやサーバーをネットワークで接続し、ひとつのコンピュータに見立てて利用できるようにしたシステムです。  
カタログから環境立ち上げを依頼するとクラスター下にあるPCやサーバーの使用状況を見て、環境立ち上げを自動的に行ってくれます。  
{{% /notice %}}

---

#### カタログを使った開発環境の起動

1. プロジェクトへの移動
2. Harborの認証情報登録
3. カタログを使ったアプリの起動
4. 立ち上げた環境へのアクセス

{{% notice warning %}}
アプリ起動する際に既存の設定をコピーするクローン機能がありますが、クローンを使うとアプリ画面から削除してもコンテナが消えない現象が発生します。  
もし、クローンでアプリを作成した場合はアプリ画面から削除の上、ワークロードから直接削除する必要があります。 
{{% /notice %}}

---

##### 1. プロジェクトへの移動

左上の”グローバル”からアクセス可能なクラスターにある”プロジェクト”を選択します。

![cluster](/images/rancher_cluster.png)

{{% notice info %}}
プロジェクトとは  
チームや開発プロジェクト単位でメンバーを管理するための仕組みとして利用できます。  
特に会社全体でクラスターを利用するような場合においてはチーム間の秘匿性を保つための仕組みとしても利用できます。  
{{% /notice %}}

{{%expand "プロジェクトトップ画面の説明"%}}

- プロジェクトトップ画面
  ![project](/images/rancher_project.png)
  
  | 番号 | 説明 |
  | ------------- | ------------- |
  | ① | 稼働しているアプリケーション一覧が表示されます。 |
  | ② | プロジェクトのトップベージが開かれます。稼働中の状態を確認するワークロードやHarborの認証情報（シークレット）登録を行う際に利用します。 |
  | ③ | 開発するためのアプリケーションを起動するための画面に移動します。 |
  | ④ | このプロジェクトにアクセスできるメンバーが表示されます。 |
  | ⑤ | ワークロードおよびサービスディスカバリーのみこのシステムでは利用します。 |
  
  {{% notice warning %}}
  ワークロードからアプリの削除を行うとアプリケーション画面では残ったままになるため、行わないでください。  
  {{% /notice %}}
{{% /expand%}}

---

##### 2. シークレットの登録

Harobrからアプリケーションのイメージを入手するために、Harborの認証情報を登録します。

{{% notice info %}}
Harborについては[こちら](../children-2)を参照してください。
{{% /notice %}}

1. 「リソース」→ 「シークレット」で移動
   ![secret](/images/rancher_secret.png)
2. 「レジストリ」のタブを選択
   ![secret2](/images/rancher_secret2.png)
3. 右側にある「レジストリを追加」を選択
   ![secret3](/images/rancher_secret3.png)
4. 必要事項を記入して登録
   - 名前：Harborと同じ名前を入力
   - スコープ：「このプロジェクトすべての名前空間で使用可能」を選択
   - カスタム：HarborのIPアドレスを入力
   - ユーザー名：Harborにログインする際のユーザ名
   - パスワード：Harborにログインする際のパスワード
   ![secret4](/images/rancher_secret4.png)

   {{% notice info %}}
   Harbor以外のNGCやDockerHubのレジストリを使う場合も登録する必要があります。
   {{% /notice %}}

---

##### 3. カタログを使ったアプリの起動

1. Appのボタンを押す  
   起動しているアプリケーションやアプリを起動するための画面が表示されます。

   {{%expand "アプリ画面の説明"%}}
   - アプリ画面
     ![app](/images/rancher_app.png)

     | 番号 | 説明 |
     | ------------- | ------------- |
     | ① | 稼働しているアプリケーション一覧が表示されます。 |
     | ② | アプリの起動ボタンです。 |
     | ③ | ブラウザでアクセス可能なアプリケーションの場合、ポート番号が表示されます。 |
   {{% /expand%}}

2. 「起動」ボタンを押し、使用したいカタログを選択
   ![select](/images/rancher_app_sel.png)

3. カタログの中にある使い方を確認しながら、必要事項を設定
   ![usage](/images/rancher_app_usage.png)

4. アプリのトップ画面で状況確認  
   クラスターのリソースが空いていれば、アプリケーションが実行されます。  
   作成したアプリを押すことで詳細情報が確認ができ、エラーなのかリソース待ちなのか確認できます。
   ![status](/images/rancher_app_status.png)

   {{%expand "エラーなのかリソース待ちなのか判断する方法"%}}
   - 確認するための4ステップ
      1. エラーが発生しているアプリを選択
         ![step1](/images/rancher_app_step1.png)
      2. ワークロードにあるコンテナを選択 
         ![step2](/images/rancher_app_step2.png)
      3. ポッドにあるコンテナを選択
         ![step3](/images/rancher_app_step3.png)
      4. Eventsを開く
         ![step4](/images/rancher_app_step4.png)
   - 判断方法
      - リソース待ちの場合  
        ”0/2 nodes are available: 2 Insufficient nvidia.com/gpu.”という内容が表示されている。  
        ![step4](/images/rancher_app_step4.png)
      - エラーの場合
        上記以外は全てエラーです。  
        - 例
          ![error](/images/rancher_app_error.png)
   {{% /expand%}}

---

##### 4.立ち上げた環境へのアクセス

立ち上げた環境にアクセスするための方法は２つあります。  

1. ターミナルでアクセス
   ![access](/images/rancher_app_access2.png)
2. UIが使える場合は表示されたポート番号からアプリにアクセス
   アプリ画面から  
   ![access](/images/rancher_app_access.png)
   アプリ詳細画面から
   ![access](/images/rancher_app_access1.png)

---

#### カタログを使った開発環境の削除

アプリのトップ画面から削除ボタンを押す

![delete](/images/rancher_app_delete.png)

{{% notice warning %}}
ワークロード画面からアプリの削除を行うとアプリケーション画面では残ったままになるため、行わないでください。  
{{% /notice %}}
